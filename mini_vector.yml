sources:
  stdin:
    type: stdin

transforms:
  # 1) Parse syslog text trong field message
  parse_syslog:
    type: regex_parse
    field: message
    pattern: '^(?P<timestamp>\S+)\s+(?P<host>\S+)\s+(?P<program>[^\[:]+)(?:\[\d+\])?:\s+(?P<severity>\w+)?\s*(?P<message>.*)$'
    drop_on_error: false         # nếu không khớp regex thì vẫn giữ event
    remove_source: false         # giữ lại message raw

  # 2) Chuẩn hóa về schema Mini SOC
  normalize:
    type: normalize_schema
    timestamp_field: timestamp   # -> @timestamp
    host_field: host             # -> host
    severity_field: severity     # -> severity
    program_field: program       # -> program
    message_field: message       # -> message
    default_log_type: linux_syslog

  # 3) Enrich bằng "mini VRL" script
  enrich:
    type: script
    script: |
      .soc_tenant = "tenant01"
      .severity = upcase(.severity)

router:
  field: log_type
  routes:
    - equals: linux_syslog
      sink: console

sinks:
  console:
    type: console
