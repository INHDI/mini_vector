sources:
  linux_syslog_http:
    type: http
    address: "0.0.0.0:8000"
    path: "/"

transforms:
  linux_syslog_remap:
    type: remap
    inputs:
      - linux_syslog_http
    source: |
      # raw_log từ log
      .raw_log = .log

      # parse syslog chuẩn RFC
      . |= parse_syslog!(.raw_log)

      # map về schema Mini SOC (host, program, message, severity, log_type, soc_tenant, ...)
      .host = .log.hostname
      .program = .log.appname
      .message = .log.message
      .severity = upcase(to_string!(.log.severity))
      .timestamp = .log.timestamp
      if exists(.log.timestamp) && .log.timestamp != null {
        .@timestamp = parse_timestamp!(.log.timestamp, format: "%+")
      } else if exists(.timestamp) && .timestamp != null {
        .@timestamp = parse_timestamp!(.timestamp, format: "%+")
      } else {
        .@timestamp = now()
      }
      .log_type = "linux_syslog"
      .soc_tenant = "tenant01"
      del(.log)



sinks:
  linux_syslog_console:
    type: console
    inputs:
      - linux_syslog_remap

  linux_syslog_opensearch:
    type: opensearch
    inputs:
      - linux_syslog_remap
    endpoints:
      - "https://10.15.7.52:9200"
    mode: bulk
    bulk:
      index: "logs-linux-syslog-%Y.%m.%d"
    retry:
      attempts: 3
      backoff_secs: 1
      max_backoff_secs: 3
    auth:
      strategy: basic
      user: "admin"
      password: "ZyxSzX^N^1RGft"
    tls:
      verify_certificate: false
      verify_hostname: false
    batch:
      max_events: 200
      timeout_secs: 1
